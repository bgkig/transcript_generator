<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Offline Whisper Transcriber</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="main.css" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              display: ['Space Grotesk', 'system-ui', 'sans-serif'],
              mono: ['JetBrains Mono', 'ui-monospace', 'SFMono-Regular', 'monospace'],
            },
            colors: {
              ink: {
                900: '#0a0f1f',
                800: '#0f172a',
                700: '#141c2f',
                600: '#1d2743',
              },
              mist: {
                100: '#e2e8f0',
                200: '#cbd5f5',
                300: '#aab6e8',
              },
              glow: {
                300: '#7ee7ff',
                400: '#41d6ff',
                500: '#0bb7ff',
              },
            },
          },
        },
      };
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-ink-900 text-mist-100">
    <div class="page-gradient"></div>
    <main class="relative mx-auto flex w-full max-w-5xl flex-col gap-8 px-6 pb-16 pt-12">
      <header class="space-y-3">
        <p class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-4 py-1 text-xs uppercase tracking-[0.3em] text-mist-300">
          Offline • Client-side • Whisper
        </p>
        <h1 class="text-balance text-4xl font-semibold text-white md:text-5xl">
          ブラウザだけで動くローカル文字起こし
        </h1>
        <p class="max-w-2xl text-sm text-mist-300 md:text-base">
          MP3 / MP4 / WAV をドラッグ＆ドロップして、すべてクライアントサイドで Whisper 文字起こし。初回ロード後はオフラインでも利用できます。
        </p>
      </header>

      <section class="grid gap-6 md:grid-cols-[1.1fr_0.9fr]">
        <div class="glass-panel space-y-6">
          <div id="dropzone" class="dropzone">
            <input id="file-input" class="sr-only" type="file" accept=".mp3,.mp4,.wav,audio/mpeg,audio/mp3,audio/wav,audio/x-wav,video/mp4" />
            <div class="dropzone-inner">
              <div class="dropzone-icon">
                <span class="icon-wave"></span>
              </div>
              <div>
                <p class="text-lg font-semibold text-white">ここにファイルをドロップ</p>
                <p class="text-sm text-mist-300">またはクリックして選択 (最大 250MB 目安)</p>
                <p class="text-xs text-mist-300">対応形式: MP3 / MP4 / WAV</p>
              </div>
            </div>
          </div>

          <div class="flex flex-wrap items-center gap-3 text-sm text-mist-300">
            <span class="status-pill" id="model-status">モデル未ロード</span>
            <span class="status-pill" id="worker-status">Worker 待機中</span>
            <span class="status-pill" id="offline-status">オンライン</span>
          </div>

          <div class="flex flex-wrap items-center gap-3 text-xs text-mist-300">
            <span class="uppercase tracking-[0.3em]">Model</span>
            <select id="model-select" class="model-select">
              <option value="base" selected>Whisper base (精度優先)</option>
              <option value="tiny">Whisper tiny (速度優先)</option>
              <option value="small">Whisper small</option>
              <option value="medium">Whisper medium</option>
              <option value="large-v3">Whisper large-v3</option>
              <option value="large-v3-turbo">Whisper large-v3 turbo</option>
            </select>
          </div>

          <div class="space-y-4">
            <div class="flex flex-wrap items-start gap-4">
              <div>
                <p class="text-xs uppercase tracking-[0.3em] text-mist-300">FILE</p>
                <p id="file-name" class="text-sm font-semibold text-white">未選択</p>
                <p id="file-details" class="text-xs text-mist-300">-</p>
              </div>
              <div class="ml-auto flex gap-2">
                <button id="clear-btn" class="ghost-btn" type="button">クリア</button>
                <button id="transcribe-btn" class="primary-btn" type="button" disabled>文字起こし開始</button>
              </div>
            </div>

            <div id="preview-wrapper" class="preview-card">
              <audio id="audio-preview" controls class="hidden w-full"></audio>
              <video id="video-preview" controls class="hidden w-full" playsinline></video>
              <p id="preview-placeholder" class="text-sm text-mist-300">プレビューがここに表示されます。</p>
            </div>
          </div>
        </div>

        <div class="space-y-6">
          <div class="glass-panel space-y-4">
            <div class="flex items-center justify-between">
              <p class="text-sm font-semibold text-white">モデルロード進捗</p>
              <span class="text-xs text-mist-300">初回のみ</span>
            </div>
            <div id="model-progress-list" class="space-y-3 text-xs text-mist-300">
              <p>まだロードされていません。</p>
            </div>
          </div>

          <div class="glass-panel space-y-4">
            <div class="flex items-center justify-between">
              <p class="text-sm font-semibold text-white">文字起こし進捗</p>
              <span id="transcribe-percent" class="text-xs text-mist-300">0%</span>
            </div>
            <div class="progress-track">
              <div id="transcribe-progress" class="progress-fill" style="width: 0%"></div>
            </div>
            <p id="transcribe-status" class="text-xs text-mist-300">待機中</p>
          </div>
        </div>
      </section>

      <section class="glass-panel space-y-4">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div>
            <p class="text-sm font-semibold text-white">文字起こし結果</p>
            <p class="text-xs text-mist-300">テキストはローカルでのみ処理されます。</p>
          </div>
          <button id="download-btn" class="ghost-btn" type="button" disabled>.txt をダウンロード</button>
        </div>
        <textarea
          id="output-text"
          class="output-area"
          placeholder="ここに文字起こし結果が表示されます。"
          rows="10"
        ></textarea>
      </section>

      <footer class="text-xs text-mist-300">
        <p>
          初回はモデルと WASM をダウンロードします。完了後は Cache API と Service Worker によりオフラインで再利用できます。
        </p>
      </footer>
    </main>

    <script type="module" src="app.js"></script>
  </body>
</html>
